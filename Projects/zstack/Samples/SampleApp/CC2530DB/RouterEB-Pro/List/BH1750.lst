###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         23/Aug/2018  14:26:06 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\zigbee_sim\Projects\zstack\Samples\SampleApp\So #
#                          urce\BH1750.c                                      #
#    Command line       =  -f D:\zigbee_sim\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\Tools\CC2530DB\f8wRouter.cfg    #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE -DRTR_NWK         #
#                          -DBLINK_LEDS) -f D:\zigbee_sim\Projects\zstack\Sam #
#                          ples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8 #
#                          wConfig.cfg (-DSECURE=0 -DZG_SECURE_DYNAMIC=0      #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\So #
#                          urce\BH1750.c -D ZIGBEEPRO -D ZTOOL_P1 -D MT_TASK  #
#                          -D MT_SYS_FUNC -D MT_ZDO_FUNC -D                   #
#                          LCD_SUPPORTED=DEBUG -lC D:\zigbee_sim\Projects\zst #
#                          ack\Samples\SampleApp\CC2530DB\RouterEB-Pro\List\  #
#                          -lA D:\zigbee_sim\Projects\zstack\Samples\SampleAp #
#                          p\CC2530DB\RouterEB-Pro\List\ --diag_suppress      #
#                          Pe001,Pa010 -o D:\zigbee_sim\Projects\zstack\Sampl #
#                          es\SampleApp\CC2530DB\RouterEB-Pro\Obj\ -e         #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\zigbee_sim\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\ -I D:\zigbee_sim\Projects\zstack\Sample #
#                          s\SampleApp\CC2530DB\..\SOURCE\ -I                 #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\ZMAIN\TI2530DB\ -I                 #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\MT\ -I            #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I   #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530 #
#                          EB\ -I D:\zigbee_sim\Projects\zstack\Samples\Sampl #
#                          eApp\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\C #
#                          CSOC\ -I D:\zigbee_sim\Projects\zstack\Samples\Sam #
#                          pleApp\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\INC #
#                          LUDE\ -I D:\zigbee_sim\Projects\zstack\Samples\Sam #
#                          pleApp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\AF #
#                          \ -I D:\zigbee_sim\Projects\zstack\Samples\SampleA #
#                          pp\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\NWK\   #
#                          -I D:\zigbee_sim\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC\ -I  #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ -I    #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\ -I     #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\ -I     #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I      #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\ZMAC\ -I          #
#                          D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\   #
#                          -I D:\zigbee_sim\Projects\zstack\Samples\SampleApp #
#                          \CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDATA #
#                          \ -I D:\zigbee_sim\Projects\zstack\Samples\SampleA #
#                          pp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUDE\ #
#                           -I D:\zigbee_sim\Projects\zstack\Samples\SampleAp #
#                          p\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVE #
#                          L\ -I D:\zigbee_sim\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEV #
#                          EL\srf04\ -I D:\zigbee_sim\Projects\zstack\Samples #
#                          \SampleApp\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\ #
#                          LOW_LEVEL\srf04\SINGLE_CHIP\ -Ohz                  #
#                          --require_prototypes                               #
#    List file          =  D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\RouterEB-Pro\List\BH1750.lst                #
#    Object file        =  D:\zigbee_sim\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\RouterEB-Pro\Obj\BH1750.r51                 #
#                                                                             #
#                                                                             #
###############################################################################

D:\zigbee_sim\Projects\zstack\Samples\SampleApp\Source\BH1750.c
      1          #include <ioCC2530.h>

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
      2          #include "OnBoard.h"
      3          
      4          
      5          #define uint unsigned int 
      6          #define uchar unsigned char
      7          #define ushort unsigned short
      8          
      9          
     10          #define st(x)      do { x } while (__LINE__ == -1)
     11          #define HAL_IO_SET(port, pin, val)        HAL_IO_SET_PREP(port, pin, val)
     12          #define HAL_IO_SET_PREP(port, pin, val)   st( P##port##_##pin## = val; )
     13          #define HAL_IO_GET(port, pin)   HAL_IO_GET_PREP( port,pin)
     14          #define HAL_IO_GET_PREP(port, pin)   ( P##port##_##pin)
     15           
     16           
     17          #define LIGHT_SCK_0()         HAL_IO_SET(1,3,0)
     18          #define LIGHT_SCK_1()         HAL_IO_SET(1,3,1)
     19          #define LIGHT_DTA_0()         HAL_IO_SET(1,1,0)
     20          #define LIGHT_DTA_1()         HAL_IO_SET(1,1,1)
     21           
     22          #define LIGHT_DTA()          HAL_IO_GET(1,1)
     23          #define LIGHT_SCK()          HAL_IO_GET(1,3)
     24           
     25          #define SDA_W() (P1DIR |=(1 << 1)  )
     26          #define SDA_R() (P1DIR &=~(1 << 1) )
     27           
     28                                 
     29          #define LIGHT_INIT()  do{P1SEL &= ~0x08;P1DIR |=0x08;P1_3 = 1;P1SEL &= ~0x02;P1DIR |= 0x02;P1_1 = 1;}while(0);
     30          
     31          
     32          void halMcuWaitUs(uint usec);
     33          void halMcuWaitMs(uint msec);
     34          void delay_us();
     35          void delay_5us();
     36          void delay_10us();
     37          void delay_nms(int n);
     38          ushort get_light(void);
     39          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     40          void halMcuWaitUs(uint usec)
   \                     halMcuWaitUs:
     41          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   800A         SJMP    ??halMcuWaitUs_0
     42              while(usec--)
     43              {
     44                  asm("nop");
   \                     ??halMcuWaitUs_1:
   \   000002   00           nop
     45                  asm("nop");
   \   000003   00           nop
     46                  asm("nop");
   \   000004   00           nop
     47                  asm("nop");
   \   000005   00           nop
     48                  asm("nop");
   \   000006   00           nop
     49                  asm("nop");
   \   000007   00           nop
     50                  asm("nop");
   \   000008   00           nop
     51                  asm("nop");
   \   000009   00           nop
     52                  asm("nop");
   \   00000A   00           nop
     53                  asm("nop");
   \   00000B   00           nop
     54              }
   \                     ??halMcuWaitUs_0:
   \   00000C   EA           MOV     A,R2
   \   00000D   F8           MOV     R0,A
   \   00000E   EB           MOV     A,R3
   \   00000F   F9           MOV     R1,A
   \   000010   E8           MOV     A,R0
   \   000011   24FF         ADD     A,#-0x1
   \   000013   1A           DEC     R2
   \   000014   E9           MOV     A,R1
   \   000015   34FF         ADDC    A,#-0x1
   \   000017   FB           MOV     R3,A
   \   000018   E8           MOV     A,R0
   \   000019   49           ORL     A,R1
   \   00001A   70E6         JNZ     ??halMcuWaitUs_1
     55          }
   \   00001C   02....       LJMP    ?BRET
     56          //ÒÔmsÑÓÊ±

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     57          void halMcuWaitMs(uint msec)
   \                     halMcuWaitMs:
     58          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   8007         SJMP    ??halMcuWaitMs_0
     59              while(msec--)
     60                  halMcuWaitUs(1000);
   \                     ??halMcuWaitMs_1:
   \   00000B                ; Setup parameters for call to function halMcuWaitUs
   \   00000B   7AE8         MOV     R2,#-0x18
   \   00000D   7B03         MOV     R3,#0x3
   \   00000F   12....       LCALL   ??halMcuWaitUs?relay
   \                     ??halMcuWaitMs_0:
   \   000012   EE           MOV     A,R6
   \   000013   F8           MOV     R0,A
   \   000014   EF           MOV     A,R7
   \   000015   F9           MOV     R1,A
   \   000016   E8           MOV     A,R0
   \   000017   24FF         ADD     A,#-0x1
   \   000019   1E           DEC     R6
   \   00001A   E9           MOV     A,R1
   \   00001B   34FF         ADDC    A,#-0x1
   \   00001D   FF           MOV     R7,A
   \   00001E   E8           MOV     A,R0
   \   00001F   49           ORL     A,R1
   \   000020   70E9         JNZ     ??halMcuWaitMs_1
     61          }
   \   000022   7F01         MOV     R7,#0x1
   \   000024   02....       LJMP    ?BANKED_LEAVE_XDATA
     62           
     63          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     64          void delay_nms(int n)
   \                     delay_nms:
     65          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     66            halMcuWaitMs(n);
   \   000004                ; Setup parameters for call to function halMcuWaitMs
   \   000004   12....       LCALL   ??halMcuWaitMs?relay
     67          }
   \   000007   80..         SJMP    ??Subroutine7_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine7_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
     68          /****************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     69          static void start_i2c(void)
   \                     start_i2c:
     70          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     71            SDA_W() ;
   \   000004   43FE02       ORL     0xfe,#0x2
     72            LIGHT_DTA_1();//
   \   000007   D291         SETB    0x90.1
     73            LIGHT_SCK_1() ;//
   \   000009   D293         SETB    0x90.3
     74            MicroWait(1);
   \   00000B                ; Setup parameters for call to function Onboard_wait
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7B00         MOV     R3,#0x0
   \   00000F   12....       LCALL   ??Onboard_wait?relay
     75            LIGHT_DTA_0() ;
   \   000012   C291         CLR     0x90.1
     76            MicroWait(1);
   \   000014                ; Setup parameters for call to function Onboard_wait
   \   000014                REQUIRE ?Subroutine0
   \   000014                REQUIRE P1DIR
   \   000014                REQUIRE _A_P1
   \   000014                ; // Fall through to label ?Subroutine0
     77            LIGHT_SCK_0() ;
     78            MicroWait(1);
     79            //delay()  ;
     80          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000003                REQUIRE ??Subroutine7_0
   \   000003                ; // Fall through to label ??Subroutine7_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??Onboard_wait?relay
   \   000007   C293         CLR     0x90.3
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009   7A01         MOV     R2,#0x1
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   12....       LCALL   ??Onboard_wait?relay
   \   000010   22           RET
     81           

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     82          static void stop_i2c(void)
   \                     stop_i2c:
     83          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
     84            SDA_W() ;
   \   000004   43FE02       ORL     0xfe,#0x2
     85            LIGHT_DTA_0() ;
   \   000007   C291         CLR     0x90.1
     86             MicroWait(1);
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009   12....       LCALL   ?Subroutine3 & 0xFFFF
     87            LIGHT_SCK_1() ;
     88             MicroWait(1);
     89            LIGHT_DTA_1() ;
   \                     ??CrossCallReturnLabel_2:
   \   00000C   D291         SETB    0x90.1
     90            MicroWait(1);
   \   00000E                ; Setup parameters for call to function Onboard_wait
   \   00000E   80..         SJMP    ?Subroutine0
   \   000010                REQUIRE P1DIR
   \   000010                REQUIRE _A_P1
     91            LIGHT_SCK_0() ;
     92            MicroWait(1);  
     93          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7A01         MOV     R2,#0x1
   \   000002   7B00         MOV     R3,#0x0
   \   000004   12....       LCALL   ??Onboard_wait?relay
   \   000007   D293         SETB    0x90.3
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009   7A01         MOV     R2,#0x1
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   12....       LCALL   ??Onboard_wait?relay
   \   000010   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     94          static char i2c_send(uchar val)                 
   \                     i2c_send:
     95          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 1,R1
     96                  int i;
     97                  char error=0;
   \   000007   75..00       MOV     ?V0 + 0,#0x0
     98                  SDA_W();
   \   00000A   43FE02       ORL     0xfe,#0x2
     99                  for(i=0x80;i>0;i/=2)
   \   00000D   7E80         MOV     R6,#-0x80
   \   00000F   7F00         MOV     R7,#0x0
    100          		{
    101          			if(val&i)
   \                     ??i2c_send_0:
   \   000011   EE           MOV     A,R6
   \   000012   55..         ANL     A,?V0 + 1
   \   000014   6004         JZ      ??i2c_send_1
    102          				LIGHT_DTA_1();
   \   000016   D291         SETB    0x90.1
   \   000018   8002         SJMP    ??i2c_send_2
    103          			else
    104          				LIGHT_DTA_0();
   \                     ??i2c_send_1:
   \   00001A   C291         CLR     0x90.1
    105          			 MicroWait(1);
   \                     ??i2c_send_2:
   \   00001C                ; Setup parameters for call to function Onboard_wait
   \   00001C   7A01         MOV     R2,#0x1
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   12....       LCALL   ??Onboard_wait?relay
    106          			LIGHT_SCK_1() ; 
   \   000023   D293         SETB    0x90.3
    107          			 MicroWait(1);
   \   000025                ; Setup parameters for call to function Onboard_wait
   \   000025   12....       LCALL   ?Subroutine2 & 0xFFFF
    108          			LIGHT_SCK_0() ;
    109          			 MicroWait(1);					
    110          		}
   \                     ??CrossCallReturnLabel_0:
   \   000028   12....       LCALL   ?S_DIV_MOD
   \   00002B   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   00002E   50E1         JNC     ??i2c_send_0
    111                  LIGHT_DTA_1();
   \   000030   D291         SETB    0x90.1
    112                  SDA_R();
   \   000032   53FEFD       ANL     0xfe,#0xfd
    113                   MicroWait(1);
   \   000035                ; Setup parameters for call to function Onboard_wait
   \   000035   12....       LCALL   ?Subroutine3 & 0xFFFF
    114                  //delay_us();
    115                  LIGHT_SCK_1() ; 
    116                   MicroWait(1);
    117                  if(LIGHT_DTA())
   \                     ??CrossCallReturnLabel_3:
   \   000038   A291         MOV     C,0x90.1
   \   00003A   5003         JNC     ??i2c_send_3
    118                      error=1;
   \   00003C   75..01       MOV     ?V0 + 0,#0x1
    119                   MicroWait(1);
   \                     ??i2c_send_3:
   \   00003F                ; Setup parameters for call to function Onboard_wait
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   7B00         MOV     R3,#0x0
   \   000043   12....       LCALL   ??Onboard_wait?relay
    120                  LIGHT_SCK_0() ;
   \   000046   C293         CLR     0x90.3
    121                  return error;
   \   000048                REQUIRE ?Subroutine1
   \   000048                REQUIRE P1DIR
   \   000048                REQUIRE _A_P1
   \   000048                ; // Fall through to label ?Subroutine1
    122                  
    123          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   A9..         MOV     R1,?V0 + 0
   \   000002   7F04         MOV     R7,#0x4
   \   000004   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   88..         MOV     ?V0 + 2,R0
   \   000002   89..         MOV     ?V0 + 3,R1
   \   000004   AE..         MOV     R6,?V0 + 2
   \   000006   AF..         MOV     R7,?V0 + 3
   \   000008   C3           CLR     C
   \   000009   EE           MOV     A,R6
   \   00000A   9401         SUBB    A,#0x1
   \   00000C   EF           MOV     A,R7
   \   00000D   9400         SUBB    A,#0x0
   \   00000F   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000011   65D0         XRL     A,PSW
   \   000013   33           RLC     A
   \   000014   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000003   EE           MOV     A,R6
   \   000004   F8           MOV     R0,A
   \   000005   EF           MOV     A,R7
   \   000006   F9           MOV     R1,A
   \   000007   7A02         MOV     R2,#0x2
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    124          static char i2c_read(char ack)
   \                     i2c_read:
    125          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 1,R1
    126                  int i;
    127                  char val=0;
   \   000007   75..00       MOV     ?V0 + 0,#0x0
    128                  LIGHT_DTA_1();
   \   00000A   D291         SETB    0x90.1
    129                  //SDA_R();
    130                  for(i=0x80;i>0;i/=2)
   \   00000C   7E80         MOV     R6,#-0x80
   \   00000E   7F00         MOV     R7,#0x0
    131                          {
    132                                  
    133                                  LIGHT_SCK_1() ;
   \                     ??i2c_read_0:
   \   000010   D293         SETB    0x90.3
    134                                  MicroWait(1);
   \   000012                ; Setup parameters for call to function Onboard_wait
   \   000012   7A01         MOV     R2,#0x1
   \   000014   7B00         MOV     R3,#0x0
   \   000016   12....       LCALL   ??Onboard_wait?relay
    135                                  SDA_R();
   \   000019   53FEFD       ANL     0xfe,#0xfd
    136                                  //SDA_W();
    137                                  //LIGHT_DTA_0();
    138                                  //LIGHT_DTA_0() ;
    139                                  
    140                                  //delay_us();
    141                                  if(LIGHT_DTA())
   \   00001C   A291         MOV     C,0x90.1
   \   00001E   5003         JNC     ??i2c_read_1
    142                                          val=(val|i);
   \   000020   EE           MOV     A,R6
   \   000021   42..         ORL     ?V0 + 0,A
    143                                   MicroWait(1);
   \                     ??i2c_read_1:
   \   000023                ; Setup parameters for call to function Onboard_wait
   \   000023   12....       LCALL   ?Subroutine2 & 0xFFFF
    144                                  //SDA_R();
    145                                  LIGHT_SCK_0() ;
    146                                   MicroWait(1);
    147                                  
    148                                  
    149                          }
   \                     ??CrossCallReturnLabel_1:
   \   000026   12....       LCALL   ?S_DIV_MOD
   \   000029   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   00002C   50E2         JNC     ??i2c_read_0
    150                  SDA_W();
   \   00002E   43FE02       ORL     0xfe,#0x2
    151                  if(ack)
   \   000031   E5..         MOV     A,?V0 + 1
   \   000033   6004         JZ      ??i2c_read_2
    152                          LIGHT_DTA_0();
   \   000035   C291         CLR     0x90.1
   \   000037   8002         SJMP    ??i2c_read_3
    153                  else
    154                          LIGHT_DTA_1();
   \                     ??i2c_read_2:
   \   000039   D291         SETB    0x90.1
    155                   MicroWait(1);
   \                     ??i2c_read_3:
   \   00003B                ; Setup parameters for call to function Onboard_wait
   \   00003B   12....       LCALL   ?Subroutine3 & 0xFFFF
    156                  LIGHT_SCK_1() ;
    157                   MicroWait(1);
    158                  LIGHT_SCK_0() ;
   \                     ??CrossCallReturnLabel_4:
   \   00003E   C293         CLR     0x90.3
    159                  LIGHT_DTA_1();
   \   000040   D291         SETB    0x90.1
    160                  return val;
   \   000042   80..         SJMP    ?Subroutine1
   \   000044                REQUIRE _A_P1
   \   000044                REQUIRE P1DIR
    161                  
    162          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    163          ushort get_light(void)
   \                     get_light:
    164          {        
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    165                  uchar ack1=1;
    166                  uchar ack2=1;
    167                  uchar ack3=1;
    168                  uchar ack4=1;
    169                  uchar ack5=1;
    170                  uchar ack6=1;
    171                  uchar ack7=1;
    172                  
    173                  uchar t0;
    174                  uchar t1;
    175                  ushort t;
    176           
    177                  P1DIR |= (1 << 1);
   \   000005   43FE02       ORL     0xfe,#0x2
    178                  delay_nms(200);
   \   000008                ; Setup parameters for call to function halMcuWaitMs
   \   000008   7AC8         MOV     R2,#-0x38
   \   00000A   7B00         MOV     R3,#0x0
   \   00000C   12....       LCALL   ??halMcuWaitMs?relay
    179           
    180          		start_i2c();
   \   00000F                ; Setup parameters for call to function start_i2c
   \   00000F   12....       LCALL   ??Subroutine8_0 & 0xFFFF
    181          		ack1=i2c_send(0x46);
    182          		if(ack1)
   \                     ??CrossCallReturnLabel_11:
   \   000012   6006         JZ      ??get_light_0
    183          				return 255;
   \   000014   7AFF         MOV     R2,#-0x1
   \                     ??get_light_1:
   \   000016   7B00         MOV     R3,#0x0
   \   000018   8065         SJMP    ??get_light_2
    184          		ack2=i2c_send(0x01);
    185          		if(ack2)
   \                     ??get_light_0:
   \   00001A                ; Setup parameters for call to function i2c_send
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   12....       LCALL   ??i2c_send?relay
   \   00001F   E9           MOV     A,R1
   \   000020   6004         JZ      ??get_light_3
    186          				return 254;
   \   000022   7AFE         MOV     R2,#-0x2
   \   000024   80F0         SJMP    ??get_light_1
    187          		stop_i2c();           //init
   \                     ??get_light_3:
   \   000026                ; Setup parameters for call to function stop_i2c
   \   000026   12....       LCALL   ?Subroutine4 & 0xFFFF
    188          		start_i2c();
    189          		ack3=i2c_send(0x46);
    190          		if(ack3)
   \                     ??CrossCallReturnLabel_9:
   \   000029   6004         JZ      ??get_light_4
    191          				return 253;
   \   00002B   7AFD         MOV     R2,#-0x3
   \   00002D   80E7         SJMP    ??get_light_1
    192          		ack4=i2c_send(0x01);
    193          		if(ack4)
   \                     ??get_light_4:
   \   00002F                ; Setup parameters for call to function i2c_send
   \   00002F   7901         MOV     R1,#0x1
   \   000031   12....       LCALL   ??i2c_send?relay
   \   000034   E9           MOV     A,R1
   \   000035   6004         JZ      ??get_light_5
    194          				return 252;
   \   000037   7AFC         MOV     R2,#-0x4
   \   000039   80DB         SJMP    ??get_light_1
    195          		stop_i2c();//power
   \                     ??get_light_5:
   \   00003B                ; Setup parameters for call to function stop_i2c
   \   00003B   12....       LCALL   ?Subroutine4 & 0xFFFF
    196          		start_i2c();
    197          		ack5=i2c_send(0x46);
    198          		if(ack5)
   \                     ??CrossCallReturnLabel_10:
   \   00003E   6004         JZ      ??get_light_6
    199          				return 251;
   \   000040   7AFB         MOV     R2,#-0x5
   \   000042   80D2         SJMP    ??get_light_1
    200          		ack6=i2c_send(0x10);
    201          		if(ack6)
   \                     ??get_light_6:
   \   000044                ; Setup parameters for call to function i2c_send
   \   000044   7910         MOV     R1,#0x10
   \   000046   12....       LCALL   ??i2c_send?relay
   \   000049   E9           MOV     A,R1
   \   00004A   6004         JZ      ??get_light_7
    202          				return 250;
   \   00004C   7AFA         MOV     R2,#-0x6
   \   00004E   80C6         SJMP    ??get_light_1
    203          		stop_i2c();                     
   \                     ??get_light_7:
   \   000050                ; Setup parameters for call to function stop_i2c
   \   000050   12....       LCALL   ??stop_i2c?relay
    204                  delay_nms(1500);
   \   000053                ; Setup parameters for call to function halMcuWaitMs
   \   000053   7ADC         MOV     R2,#-0x24
   \   000055   7B05         MOV     R3,#0x5
   \   000057   12....       LCALL   ??halMcuWaitMs?relay
    205                  start_i2c();
   \   00005A                ; Setup parameters for call to function start_i2c
   \   00005A   12....       LCALL   ??start_i2c?relay
    206                  
    207          		ack7=i2c_send(0x47);
    208          		if(ack7)
   \   00005D                ; Setup parameters for call to function i2c_send
   \   00005D   7947         MOV     R1,#0x47
   \   00005F   12....       LCALL   ??i2c_send?relay
   \   000062   E9           MOV     A,R1
   \   000063   6004         JZ      ??get_light_8
    209          				return 249;
   \   000065   7AF9         MOV     R2,#-0x7
   \   000067   80AD         SJMP    ??get_light_1
    210                                  
    211                  t0 = i2c_read(1);
   \                     ??get_light_8:
   \   000069                ; Setup parameters for call to function i2c_read
   \   000069   7901         MOV     R1,#0x1
   \   00006B   12....       LCALL   ??i2c_read?relay
   \   00006E   E9           MOV     A,R1
   \   00006F   FE           MOV     R6,A
    212                  t1 = i2c_read(0);
   \   000070                ; Setup parameters for call to function i2c_read
   \   000070   7900         MOV     R1,#0x0
   \   000072   12....       LCALL   ??i2c_read?relay
   \   000075   E9           MOV     A,R1
   \   000076   F5..         MOV     ?V0 + 0,A
    213                  stop_i2c();
   \   000078                ; Setup parameters for call to function stop_i2c
   \   000078   12....       LCALL   ??stop_i2c?relay
    214                  t =  ((short)t0)<<8;
    215                  t |= t1;
    216                  return t;
   \   00007B   EE           MOV     A,R6
   \   00007C   AA..         MOV     R2,?V0 + 0
   \   00007E   FB           MOV     R3,A
   \                     ??get_light_2:
   \   00007F   7F02         MOV     R7,#0x2
   \   000081   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000084                REQUIRE P1DIR
    217          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ??stop_i2c?relay
   \   000003                ; Setup parameters for call to function start_i2c
   \   000003                ; Setup parameters for call to function start_i2c
   \   000003                REQUIRE ??Subroutine8_0
   \   000003                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   12....       LCALL   ??start_i2c?relay
   \   000003                ; Setup parameters for call to function i2c_send
   \   000003                ; Setup parameters for call to function i2c_send
   \   000003                ; Setup parameters for call to function i2c_send
   \   000003   7946         MOV     R1,#0x46
   \   000005   12....       LCALL   ??i2c_send?relay
   \   000008   E9           MOV     A,R1
   \   000009   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??halMcuWaitUs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    halMcuWaitUs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??halMcuWaitMs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    halMcuWaitMs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??delay_nms?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    delay_nms

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??start_i2c?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    start_i2c

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??stop_i2c?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    stop_i2c

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??i2c_send?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    i2c_send

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??i2c_read?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    i2c_read

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??get_light?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    get_light
    218           

   Maximum stack usage in bytes:

     Function          ISTACK PSTACK XSTACK
     --------          ------ ------ ------
     delay_nms             2      0      0
       -> halMcuWaitMs     4      0      0
     get_light             0      0     10
       -> halMcuWaitMs     0      0     20
       -> start_i2c        0      0     20
       -> i2c_send         0      0     20
       -> i2c_send         0      0     20
       -> stop_i2c         0      0     20
       -> start_i2c        0      0     20
       -> i2c_send         0      0     20
       -> i2c_send         0      0     20
       -> stop_i2c         0      0     20
       -> start_i2c        0      0     20
       -> i2c_send         0      0     20
       -> i2c_send         0      0     20
       -> stop_i2c         0      0     20
       -> halMcuWaitMs     0      0     20
       -> start_i2c        0      0     20
       -> i2c_send         0      0     20
       -> i2c_read         0      0     20
       -> i2c_read         0      0     20
       -> stop_i2c         0      0     20
     halMcuWaitMs          0      0     19
       -> halMcuWaitUs     0      0     18
     halMcuWaitUs          0      0      9
     i2c_read              0      0     22
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
     i2c_send              0      0     22
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
       -> Onboard_wait     0      0     24
     start_i2c             2      0     10
       -> Onboard_wait     4      0      0
       -> Onboard_wait     4      0      0
       -> Onboard_wait     4      0      0
     stop_i2c              2      0     10
       -> Onboard_wait     4      0      0
       -> Onboard_wait     4      0      0
       -> Onboard_wait     4      0      0
       -> Onboard_wait     4      0      0


   Segment part sizes:

     Function/Label       Bytes
     --------------       -----
     _A_P1                   1
     P1DIR                   1
     halMcuWaitUs           31
     halMcuWaitMs           39
     delay_nms               9
     ??Subroutine7_0         7
     start_i2c              20
     ?Subroutine0            3
     ?Subroutine6           17
     stop_i2c               16
     ?Subroutine3           17
     i2c_send               72
     ?Subroutine1            7
     ?Subroutine5           21
     ?Subroutine2           12
     i2c_read               68
     get_light             132
     ?Subroutine4            3
     ??Subroutine8_0        10
     ??halMcuWaitUs?relay    6
     ??halMcuWaitMs?relay    6
     ??delay_nms?relay       6
     ??start_i2c?relay       6
     ??stop_i2c?relay        6
     ??i2c_send?relay        6
     ??i2c_read?relay        6
     ??get_light?relay       6

 
 484 bytes in segment BANKED_CODE
  48 bytes in segment BANK_RELAYS
   2 bytes in segment SFR_AN
 
 532 bytes of CODE memory
   0 bytes of DATA memory (+ 2 bytes shared)

Errors: none
Warnings: none
